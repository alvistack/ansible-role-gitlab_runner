#!/bin/bash

# {{ ansible_managed }}

set -ex

HOSTNAME="$(cat HOSTNAME)"

docker run -itd \
  --name ${HOSTNAME} \
  --hostname ${HOSTNAME} \
  --cpus={{ gitlab_runner_runners_custom_cpus }} \
  --memory={{ gitlab_runner_runners_custom_memory }} \
  --memory-swap={{ gitlab_runner_runners_custom_memory_swap }} \
  --privileged={{ gitlab_runner_runners_custom_privileged | bool }} \
  --workdir /home/gitlab-runner \
  --volume /root/.vagrant.d/boxes:/root/.vagrant.d/boxes \
  --volume /var/cache/gitlab-runner:/var/cache/gitlab-runner \
  --volume /var/lib/docker:/var/lib/docker \
  --volume /var/run/docker.sock:/var/run/docker.sock \
  --volume /var/run/libvirt/libvirt-sock:/var/run/libvirt/libvirt-sock \
  {{ gitlab_runner_runners_custom_image }} bash
